---
title: "Exploratory Data Analysis and Visualization"
subtitle: "Lecture 03"
author: "Vivek Srikrishnan"
course: "BEE 4850"
institution: "Cornell University"
date: "January 26, 2026"
format:
    revealjs: default
engine: julia
filters:
  - code-fullscreen
---

```{julia}
#| output: false

import Pkg
Pkg.activate(@__DIR__)
Pkg.instantiate()
```

```{julia}
#| output: false

using Random
using Distributions
using ColorSchemes
using CSV
using DataFrames
using DataFramesMeta
using Plots
using StatsPlots
using StatsBase
using LaTeXStrings
using Measures

Random.seed!(1)

plot_font = "Computer Modern"
default(
    fontfamily=plot_font,
    linewidth=3, 
    framestyle=:box, 
    label=nothing, 
    grid=false,
    guidefontsize=18,
    legendfontsize=16,
    tickfontsize=16,
    titlefontsize=20,
    bottom_margin=10mm,
    left_margin=5mm
)
```

# Review

## Probability Fundamentals

- Bayesian vs. Frequentist Interpretations
- Distributions reflect assumptions on probability of data.
- Normal distributions: "least informative" distribution for a given mean/variance.
- Fit distributions by maximizing likelihood.
- Communicating uncertainty: confidence vs. predictive intervals.


# Exploratory Data Analysis


## You Can Always Fit Models...

:::: {.columns}
::: {.column width=50%}
But not all models **are theoretically justifiable**.
:::
::: {.column width=50%}
![Ian Malcolm meme](memes/ian_malcolm_should_model.png)
:::
::::

## Some Implications of Mis-Specification

- Biased estimates (expected value from the model does not match "true" expected value);
- Incorrect inferences or inappropriate understandings of relationships/causality.
- Over/under-confident risk assessments.

## Data Generation Approximates Reality

:::: {.columns}
::: {.column width=33%}
![Estimand Estimator Cake](memes/estimand_cake.png){width=100%}
:::
::: {.column width=33%}
::: {.fragment .fade-in}
![Estimand Estimator Cake](memes/estimator_cake.png){width=100%}
:::
:::
::: {.column width=33%}
::: {.fragment .fade-in}
![Estimate Cake](memes/estimate_cake.png){width=100%}
:::
:::
::::

::: {.caption}
Source: Richard McElreath
:::

::: {.notes}
Goal is to start with some "true" process, then apply a procedure (experimental/observational + statistical) and recover what is hopefully a good estimate.

But lots can go wrong in this process!
:::


## How Do We Choose What To Model?

![XKCD 2620](https://imgs.xkcd.com/comics/health_data.png)

::: {.caption}
Source: [XKCD 2620](https://xkcd.com/2620/)
:::

## How Do We Choose What To Model?

Developing suitable models often starts with both **exploratory data analysis (EDA)** and **theoretical reasoning**.

::: {.incremental}
1. **EDA**: examining patterns/relationships with visual (plots, clustering) or quantitative (correlations).
2. **Theory**: Avoids "data dredging" or "mining," which can find spurious correlations or patterns which are misleading without broader context about data-generating mechanisms.
:::


## Exploratory Data Analysis

- Will see many examples of this throughout the semester.
- Try to impose as few assumptions as possible.
- Goal of exploratory analysis is to **get a high-level view of the data** and **formulate hypotheses/check if data is fit for purpose**.

## Common EDA Questions

- What is the range of the data?
- Are there missing data or strange outliers? What might explain them?
- Is a particular relationship or distribution supported by the data?


## Common EDA Approaches

- Data summaries (quantiles, mean/median, max/min, etc.)
- Correlations
- **Plot data** (from multiple perspectives)
- Clustering (do you need multiple models?)

## Example: NY Air Quality Dataset

```{julia}
#| echo: true
#| code-fold: true
#| output: true

aq = DataFrame(CSV.File("data/airquality/airquality.csv"))
rename!(aq, :"Solar.R" => :Solar) # rename solar radiation column to get rid of period
aq[1:5, :]
```

## Quantitative EDA: Summaries

```{julia}
#| echo: true
#| code-fold: true
#| output: true

aq_stack = stack(aq, 2:5)
aq_gp = @groupby(aq_stack, :variable)
@combine(aq_gp, $AsTable = (
        min=minimum(skipmissing(:value)), 
        median=median(skipmissing(:value)),
        mean=mean(skipmissing(:value)),
        max=maximum(skipmissing(:value)),
        missings=sum(ismissing.(:value))
    )
)

```

## Quantitative EDA: Correlations

```{julia}
#| echo: true
#| code-fold: true
#| output: true

aq_cor = cor(Matrix(dropmissing(aq[:, 2:5])))
DataFrame(aq_cor, names(aq[:, 2:5]))
```

# Visualization

## Anscombe's Quartet

:::: {.columns}

::: {.column width=40%}
Four datasets, all with the same means, variances, correlations, and regression lines.

Shows the importance of visualization!
:::
::: {.column width=60%}
![Anscombe's Quartet](figures/Anscombe.svg)

::: {.caption}
Source: [Wikipedia](https://en.wikipedia.org/wiki/Anscombe%27s_quartet)
:::
:::
::::


## Visualizations for EDA

- Often useful to start with **scatterplots**: one variable (typically independent) on the $x$-axis, another (typically dependent) on the $y$-axis.
- Time series: **time always goes on the $x$-axis**.
- Boxplots for comparison quantiles/ranges of variables or groups of data.

## Considerations When Plotting

- Worry about the vertical scale
    - Are you exaggerating small changes? Downplaying meaningful changes?
    - "Adjust vertical scale of data" to reflect meaningful changes and "Vertical scale should always include zero" are conflicting advice.
- Need to be thoughtful: **there is no such thing as objectively "correct" visualizations**, just **honest** visualizations. 

## Avoid Using Two Vertical Axes

![Two axis plot](https://datawrapper.de/cdn-cgi/image/quality=85,width=1920,f=auto,fit=cover/https://kirby.datawrapper.de/media/pages/blog/dualaxis/e402201aef-1740123107/full-180508_index6.png)

::: {.caption}
Source: [Datawrapper.de](https://www.datawrapper.de/blog/dualaxis)
:::

## Avoid Using Two Vertical Axes

:::: {.columns}
::: {.column width=50%}
![Two axis plot](https://datawrapper.de/cdn-cgi/image/quality=85,width=1920,f=auto,fit=cover/https://kirby.datawrapper.de/media/pages/blog/dualaxis/e402201aef-1740123107/full-180508_index6.png)

::: {.caption}
Source: [Datawrapper.de](https://www.datawrapper.de/blog/dualaxis)
:::

:::
::: {.column width=50%}
![Illustration of how rescaling axes manipulates impression](https://datawrapper.de/cdn-cgi/image/quality=85,width=1920,f=auto,fit=cover/https://kirby.datawrapper.de/media/pages/blog/dualaxis/df214d6e10-1740123107/full-180508_index9.png)
:::
::::

::: {.caption}
Source: [Datawrapper.de](https://www.datawrapper.de/blog/dualaxis)
:::


## Encode Information With Marks and Channels

:::: {.columns}
::: {.column width=50%}
**Marks**: Geometric primitives

- Points
- Segments
- Paths
- Polygons

:::
::: {.column width=50%}
**Channels**: Mark appearance

- Color (Hue/Saturation/Luminescence)
- Position (1D/2D/3D)
- Size (Length/Area/Volume)
- Angle

:::
::::

## Ordered vs. Categorical Attributes

The channels available depend on the type of attribute:

- **Ordered** attributes can be 
  - *Ordinal*: Ranking, no meaning to distance;
  - *Quantitative*: Measure of magnitude which supports arithmetic comparison;
- **Categorical** attributes are unordered.

## Channel Effectiveness: Ordered Data

:::: {.columns}
::: {.column width=75%}
![](figures/ordered-channels.png){fig-align=center}
:::
::: {.column width=25%}
::: {.caption}
Channels for ordered data, arranged top-to-bottom from more to less effective (channels in the right column are less effective than those in the left). Modified from @Healy2018-zx after @Munzner2014-pj.
:::
:::
::::

## Channel Effectiveness: Categorical Data

:::: {.columns}
::: {.column width=75%}
![](figures/categorical-channels.png){fig-align=center width=5in}
:::
::: {.column width=25%}
::: {.caption}
Channels for categorical data, arranged top-to-bottom from more to less effective. Modified from Healy (2018) after Munzer (2014).
:::
:::
::::

## Preattentive Popout

:::: {.columns}
::: {.column width=30%}
Try to make your key features "pop out" to the viewer during the pre-attentive scan.

::: {.caption}
Searching for the blue circle becomes harder. Adapted from @Healy2018-zx.
:::
:::
::: {.column width=70%}

```{julia}
#| code-fold: true
#| echo: true
npt = 20
dist = Distributions.Product(Uniform.([0, 0], [1, 1]))
pts = Tuple.(eachcol(rand(dist, npt)))
blueidx = rand(1:npt)
p1 = scatter(pts[1:end .!= blueidx], color=:red, xticks=:false, yticks=:false, legend=:false, markersize=5, title="Color Only, N=20", framestyle=:box)
scatter!(p1, pts[blueidx, :], color=:blue, markersize=5)

npt = 100
pts = Tuple.(eachcol(rand(dist, npt)))
blueidx = rand(1:npt)
p2 = scatter(pts[1:end .!= blueidx], color=:red, xticks=:false, yticks=:false, legend=:false, markersize=5, title="Color Only, N=100", framestyle=:box)
scatter!(p2, pts[blueidx, :], color=:blue, markersize=5)

npt = 20
pts = Tuple.(eachcol(rand(dist, npt)))
blueidx = rand(1:npt)
p3 = scatter(pts[1:end .!= blueidx], color=:blue, markershape=:utriangle, xticks=:false, yticks=:false, legend=:false, markersize=5, title="Shape Only, N=20", framestyle=:box)
scatter!(p3, pts[blueidx, :], color=:blue, markersize=5, markershape=:circle)

npt = 100
pts = Tuple.(eachcol(rand(dist, npt)))
blueidx = rand(1:npt)
p4 = scatter(pts[1:end .!= blueidx], color=:blue, markershape=:utriangle, xticks=:false, yticks=:false, legend=:false, markersize=5, title="Shape Only, N=100", framestyle=:box)
scatter!(p4, pts[blueidx, :], color=:blue, markersize=5, markershape=:circle)

plot(p1, p2, p3, p4, layout=(2, 2), size=(800, 500))
```

:::
::::

## Principle of Proportional Ink

:::: {.columns}
::: {.column width=40%}
**On the left**: 2014 quantity is **~1.1x** 2010 value, but due to vertical scale the 2014 bar uses **2.7x** the ink.

Can mislead viewers into thinking the difference is larger than it truly is!
:::
::: {.column width=60%}
![Illustration of Non-Proportional Ink](https://callingbullshit.org/tools/img/Tennessee_nonfarm_jobs.png)

::: {.caption}
Source: [Calling Bullshit](https://callingbullshit.org/tools/tools_proportional_ink.html)
:::
:::
::::

## Color Schemes

Different color schemes are appropriate depending on whether the data is *sequential*, *divergent*, or *unordered*.

::: {.callout-important}
### Appropriate Color Schemes

Color schemes should be *perceptually uniform* to preserve a mapping between changes in perceived colors and changes in attribute values. 

Try to also choose color schemes which avoid confusing people who are color blind.
:::


## Color Schemes

**Good news**: Most plotting libraries include a wide variety of perceptually uniform, color-blind safe color schemes.

**Bad news**: These are not usually the defaults (in particular, avoid "rainbow" color schemes).

## Sequential Color Schemes

Sequential schemes change in intensity from low to high as the value changes. 

```{julia}
#| fig-align: center
ColorSchemes.Blues_7
```

## Divergent Color Schemes

Divergent schemes intensify in two directions from a zero or mean value.

```{julia}
reverse(ColorSchemes.PRGn_7)
```

## Unordered Color Schemes

Unordered schemes are appropriate for categorical data. 

```{julia}
reverse(ColorSchemes.Dark2_7)
```



## Some Caveats

::: {.incremental}
- There is no recipe to effective visualization. Everything depends on your data and the story you want to tell.
- This also means that defaults from data visualization packages are usually bad.
- Principles are largely based on Western (American/European) norms and may not translate perfectly.
- A lot of these guidelines are based on average outcomes, there is likely to be a lot of individual variation.
:::


# Visualization Example

## First Attempt: Paired Scatterplots

```{julia}
#| code-fold: true
#| echo: true
#| label: fig-explore1
#| fig-cap: Paired plots of air quality dataset

# this uses the dataframe plotting syntax from StatsPlots.jl
p1 = @df aq scatter(:Ozone, :Solar, markersize=5, color=:blue, xlabel="Ozone (ppb)", ylabel="Solar Radiation (lang)", leftmargin=10mm)
p2 = @df aq scatter(:Ozone, :Wind, markersize=5, color=:blue, xlabel="Ozone (ppb)", ylabel="Wind Speed (mph)", leftmargin=10mm)
p3 = @df aq scatter(:Ozone, :Temp, markersize=5, color=:blue, xlabel="Ozone (ppb)", ylabel="Max Temperature (°F) ", leftmargin=10mm)

p = plot(p1, p2, p3, layout=(1, 3), size=(1100, 400))

```

## Do Multiple Channels Help?

```{julia}
#| code-fold: true
#| echo: true
#| label: fig-explore2
#| fig-cap: Scatterplot of air quality dataset with solar color

# this uses the dataframe plotting syntax from StatsPlots.jl
aq2 = dropmissing(aq)
p = @df aq2 scatter(:Ozone, :Wind, marker_z=:Solar,
    xlabel="Ozone (ppb)", 
    ylabel="Wind Speed (mph)", 
    colorbar_title="Solar Radiation (lang)",
    c=:reds,
    markersize=5
)
```

## Do Multiple Channels Help?

```{julia}
#| code-fold: true
#| echo: true
#| label: fig-explore3
#| fig-cap: Scatterplot of air quality dataset with temperature color

# this uses the dataframe plotting syntax from StatsPlots.jl
aq2 = dropmissing(aq)
p = @df aq2 scatter(:Ozone, :Wind, marker_z=:Temp,
    xlabel="Ozone (ppb)", 
    ylabel="Wind Speed (mph)", 
    colorbar_title="Max Temperature (°F)",
    c=:reds,
    markersize=5
)
```


# Key Points


## EDA/Data Visualization

- **EDA**: Understand structure of data while making as few assumptions as possible (e.g. look at the raw data, not "smoothed" versions).
- No such thing as "objectively best" visualization.
- Need to be thoughtful about the story you're trying to tell.
- Usually involves a lot of experimentation to make important features of the data pop out.

## Data Visualization Suggestions

- Some key degrees of freedom: vertical scale, information channels.
- **Don't add unnecessary artifacts!** Easy to get "cute" and distract from core message.
- Start simple (scatterplots, boxplots, histograms)
- **Don't make 3D plots. Don't use two vertical axes.**
- Always ask yourself: are you honestly presenting the data and is your visual consistent with your story?

# Upcoming Schedule

## Next Classes

**Wednesday**: Probability Models and Linear Regression 

**Friday**: Data Visualization Lab (come prepared with a visualization and its underlying dataset).

## Assessments

**Homework 1** Due Friday, 2/6.

# References

## References (Scroll for Full List)
