---
title: "Data Visualization"
subtitle: "Lecture 04"
author: "Vivek Srikrishnan"
course: "BEE 4850"
institution: "Cornell University"
date: "January 30, 2026"
format:
    revealjs:
        slide-number: c/t
        show-slide-number: all
        center-title-slide: true
        width: 1280
        height: 720
        transition: none
        toc: true
        toc-depth: 1
        toc-title: "Overview"
        history: false
        link-external-newwindow: true
        theme: ../sass/slides.scss
        template-partials:
            - title-slide.html
        menu:
            numbers: true
        html-math-method: mathjax
        include-in-header: mathjax-config.html
        date-format: long
        email-obfuscation: javascript
        chalkboard:
            theme: whiteboard
            buttons: true
        mermaid: 
            theme: dark
engine: julia
filters:
  - code-fullscreen
---

```{julia}
#| output: false

import Pkg
Pkg.activate(@__DIR__)
Pkg.instantiate()
```

```{julia}
#| output: false

using Random
using DataFrames
using DataFramesMeta
using CSV
using Dates
using Distributions
using ColorSchemes
using Plots
using StatsPlots
using StatsBase
using GLM
using Optim
using LaTeXStrings
using Measures

Random.seed!(1)

plot_font = "Computer Modern"
default(
    fontfamily=plot_font,
    linewidth=3, 
    framestyle=:box, 
    label=nothing, 
    grid=false,
    guidefontsize=18,
    legendfontsize=16,
    tickfontsize=16,
    titlefontsize=20,
    bottom_margin=10mm,
    left_margin=5mm
)
```

# Review

## EDA

- **EDA**: Understand structure of data while making as few assumptions as possible (e.g. look at the raw data, not "smoothed" versions).
- You might be asking the "right" questions but have the "wrong" data: be open-minded and rely on domain knowledge.
- Quantitative EDA can be a starting point, but EDA also requires visualization.

# Data Visualization

## Challenges for Effective Visualization

::: {.incremental}
- Limits From Cognitive Processes
- No "Optimal" Visualization
- Temptation To Overload Figures
- Easy to "Lie" About The Data
:::

## Further Challenges

Following @Munzner2014-pj:

::: {.incremental}
- Possible designs are a bad match with human perceptual and cognitive systems;
- Possible designs are a bad match with the intended task;
- Only a small number of possibilities are reasonable choices;
- "**Randomly choosing possibilities is a bad idea because the odds of finding a very good solution are very low**."
:::

## Remember: Data Never Speaks For Itself

Data must be understood in a particular context. You need to understand your data and what it says (or does not say!) based on your hypotheses.

::: {.incremental}
- What question(s) does your data address?
- What transformations make the representation of the data as salient as possible?
- What scales or channels are most appropriate?
:::

## Some Caveats

::: {.incremental}
- There is no recipe to effective visualization. Everything depends on your data and the story you want to tell.
- This also means that defaults from data visualization packages are usually bad.
- Principles are largely based on Western (American/European) norms and may not translate perfectly.
- A lot of these guidelines are based on average outcomes, there is likely to be a lot of individual variation.
:::

# Some Data Viz Principles

## Gestalt Principles

The Gestalt school of psychology identified several principles of perception.

Core idea: **Humans are very good at finding structure.**

::: {.fragment .fade-in}
As a result, you need to evaluate the totality of a visual field, not just each component.
:::

## Gestalt Principles

:::: {.columns}

::: {.column width=40%}
- Proximity
- Similarity
- Connection
- Common Fate
- Continuity
- Closure
:::

::: {.column width=60%}
![Illustration of Gestalt principles](figures/gestalt-01.png)

::: {.caption}
Illustration of several Gestalt principles. Adapted from @Healy2018-zx.
:::

:::
::::

## Impact of Continuity

```{julia}
#| label: fig-continuity
#| code-fold: true
#| echo: true
#| fig-cap: Illustrating impact of connected points.


# create trend for data
x = rand(Uniform(0, 20), 10)
y = 5 .+ 2 * x
# sample and add noise
ε = rand(Normal(0, 5), 10)
y .+= ε

p1 = scatter(x, y, xlabel=L"$x$", ylabel=L"$y$", color=:blue, markersize=8)
p2 = plot(sort(x), sort(y), xlabel=L"$x$", ylabel=L"$y$", color=:blue, marker=:circle, markersize=8)

plot(p1, p2, layout=(1,2), size=(1100, 500))
```


## Vertical Scales

- Worry about the vertical scale
    - Are you exaggerating small changes? Downplaying meaningful changes?
    - "Adjust vertical scale of data" to reflect meaningful changes and "Vertical scale should always include zero" are conflicting advice.


## Principle of Proportional Ink

:::: {.columns}
::: {.column width=40%}
**On the left**: 2014 quantity is **~1.1x** 2010 value, but due to vertical scale the 2014 bar uses **2.7x** the ink.

Can mislead viewers into thinking the difference is larger than it truly is!
:::
::: {.column width=60%}
![Illustration of Non-Proportional Ink](https://callingbullshit.org/tools/img/Tennessee_nonfarm_jobs.png)

::: {.caption}
Source: [Calling Bullshit](https://callingbullshit.org/tools/tools_proportional_ink.html)
:::
:::
::::

## What Makes A Good Color Scheme?

- *Perceptually uniformity*: preserve a mapping between changes in perceived colors and changes in attribute values. 
- *Color-blind safe!* 



## Color Schemes

**Good news**: Most plotting libraries include a wide variety of perceptually uniform, color-blind safe color schemes.

**Bad news**: These are not usually the defaults (in particular, avoid "rainbow" color schemes).

Good site: [Paul Tol's color schemes](https://sronpersonalpages.nl/~pault/). 

## Sequential Color Schemes

Sequential schemes change in intensity from low to high as the value changes. 

```{julia}
#| fig-align: center
ColorSchemes.Blues_7
```

## Divergent Color Schemes

Divergent schemes intensify in two directions from a zero or mean value.

```{julia}
reverse(ColorSchemes.PRGn_7)
```

## Unordered Color Schemes

Unordered schemes are appropriate for categorical data. 

```{julia}
reverse(ColorSchemes.Dark2_7)
```

## Avoid Using Two Vertical Axes

![Two axis plot](https://datawrapper.de/cdn-cgi/image/quality=85,width=1920,f=auto,fit=cover/https://kirby.datawrapper.de/media/pages/blog/dualaxis/e402201aef-1740123107/full-180508_index6.png)

::: {.caption}
Source: [Datawrapper.de](https://www.datawrapper.de/blog/dualaxis)
:::

## Avoid Using Two Vertical Axes

:::: {.columns}
::: {.column width=50%}
![Two axis plot](https://datawrapper.de/cdn-cgi/image/quality=85,width=1920,f=auto,fit=cover/https://kirby.datawrapper.de/media/pages/blog/dualaxis/e402201aef-1740123107/full-180508_index6.png)


:::
::: {.column width=50%}
![Illustration of how rescaling axes manipulates impression](https://datawrapper.de/cdn-cgi/image/quality=85,width=1920,f=auto,fit=cover/https://kirby.datawrapper.de/media/pages/blog/dualaxis/df214d6e10-1740123107/full-180508_index9.png)
:::
::::

::: {.caption}
Source: [Datawrapper.de](https://www.datawrapper.de/blog/dualaxis)
:::

## Example: Spurious Correlations

![Spurious Correlation 5901](https://www.tylervigen.com/spurious/correlation/image/5901_annual-us-household-spending-on-fresh-fruits_correlates-with_canadian-national-railway-companys-stock-price-cni.png)


::: {.caption}
Source: [Spurious Correlations](https://www.tylervigen.com/spurious/correlation/5901_annual-us-household-spending-on-fresh-fruits_correlates-with_canadian-national-railway-companys-stock-price-cni)
:::

## Encode Information With Marks and Channels

:::: {.columns}
::: {.column width=50%}
**Marks**: Geometric primitives

- Points
- Segments
- Paths
- Polygons

:::
::: {.column width=50%}
**Channels**: Mark appearance

- Color (Hue/Saturation/Luminescence)
- Position (1D/2D/3D)
- Size (Length/Area/Volume)
- Angle

:::
::::

## Ordered vs. Categorical Attributes

The channels available depend on the type of attribute:

- **Ordered** attributes can be 
  - *Ordinal*: Ranking, no meaning to distance;
  - *Quantitative*: Measure of magnitude which supports arithmetic comparison;
- **Categorical** attributes are unordered.

## Channel Effectiveness: Ordered Data

:::: {.columns}
::: {.column width=75%}
![](figures/ordered-channels.png){fig-align=center}
:::
::: {.column width=25%}
::: {.caption}
Channels for ordered data, arranged top-to-bottom from more to less effective (channels in the right column are less effective than those in the left). Modified from @Healy2018-zx after @Munzner2014-pj.
:::
:::
::::

## Channel Effectiveness: Categorical Data

:::: {.columns}
::: {.column width=75%}
![](figures/categorical-channels.png){fig-align=center width=5in}
:::
::: {.column width=25%}
::: {.caption}
Channels for categorical data, arranged top-to-bottom from more to less effective. Modified from Healy (2018) after Munzer (2014).
:::
:::
::::

## Preattentive Popout

:::: {.columns}
::: {.column width=30%}
Try to make your key features "pop out" to the viewer during the pre-attentive scan.

::: {.caption}
Searching for the blue circle becomes harder. Adapted from @Healy2018-zx.
:::
:::
::: {.column width=70%}

```{julia}
#| code-fold: true
#| echo: true
npt = 20
dist = Distributions.Product(Uniform.([0, 0], [1, 1]))
pts = Tuple.(eachcol(rand(dist, npt)))
blueidx = rand(1:npt)
p1 = scatter(pts[1:end .!= blueidx], color=:red, xticks=:false, yticks=:false, legend=:false, markersize=5, title="Color Only, N=20", framestyle=:box)
scatter!(p1, pts[blueidx, :], color=:blue, markersize=5)

npt = 100
pts = Tuple.(eachcol(rand(dist, npt)))
blueidx = rand(1:npt)
p2 = scatter(pts[1:end .!= blueidx], color=:red, xticks=:false, yticks=:false, legend=:false, markersize=5, title="Color Only, N=100", framestyle=:box)
scatter!(p2, pts[blueidx, :], color=:blue, markersize=5)

npt = 20
pts = Tuple.(eachcol(rand(dist, npt)))
blueidx = rand(1:npt)
p3 = scatter(pts[1:end .!= blueidx], color=:blue, markershape=:utriangle, xticks=:false, yticks=:false, legend=:false, markersize=5, title="Shape Only, N=20", framestyle=:box)
scatter!(p3, pts[blueidx, :], color=:blue, markersize=5, markershape=:circle)

npt = 100
pts = Tuple.(eachcol(rand(dist, npt)))
blueidx = rand(1:npt)
p4 = scatter(pts[1:end .!= blueidx], color=:blue, markershape=:utriangle, xticks=:false, yticks=:false, legend=:false, markersize=5, title="Shape Only, N=100", framestyle=:box)
scatter!(p4, pts[blueidx, :], color=:blue, markersize=5, markershape=:circle)

plot(p1, p2, p3, p4, layout=(2, 2), size=(800, 500))
```

:::
::::



# Visualization Examples


## Thoughts On This Plot?

::: {.center}
![First Street Foundation Return Period Trends](figures/shu-etal-returnperiods.png)
:::

::: {.caption}
Source: @Shu2023-ht
:::

## How About This One?

::: {.center}
![Trump Polling Average vs. Employment in Swing States](figures/swingstate-morgan.jpeg)
:::

::: {.caption}
Source: [Joe Weisenthal](https://twitter.com/TheStalwart/status/1309582619290595328)
:::

## Or This One?

::: {.center}
![Impacts of Climate Mitigation on Air Pollution](figures/huang_air_pollution.png)
:::

::: {.caption}
Source: @Huang2023-nm
:::


## Or...

::: {.center}
![Relationship Between Climate Variables](figures/errickson-2021_correlations.png)
:::

::: {.caption}
Source: @Errickson2021-kr
:::

## Last One!

::: {.center}
![Modeled Flood Risk vs. Perception](figures/bakkensen-floodrisk.jpeg){width=55%}
:::

::: {.caption}
Source: @Bakkensen2022-xj
:::


# Key Points

## Data Visualization

- No "cookbook": be thoughtful and honest with your data.
- Defaults from software packages (scales, colors, etc.) are usually bad.
- Think carefully about if you're creating artifacts which might mislead others, even if unintentional.


# Upcoming Schedule

## Next Classes

**Next Week**: Probability Models and Linear Regression


## Assessments

**Homework 1** Due Friday, 2/6.

**Exercises**: This week's involves some simple computations.

**Reading**: Franconeri et al (2024)

**Quiz 1**: Friday, 2/13.

# References

## References (Scroll for Full List)
